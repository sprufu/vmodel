/*! vmodel 2014-12-14 */
!function(a,b,c){function d(){var a,b,c,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"!=typeof h&&"function"!=typeof h&&(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(a=arguments[i]))for(b in a)c=h[b],e=a[b],h!==e&&(k&&e&&(N.type(e,"object")||(f=N.type(e,"array")))?(f?(f=!1,g=c&&N.type(c,"object")?c:[]):g=c&&N.type(c,"object")?c:{},h[b]=d(k,g,e)):void 0!==e&&(h[b]=e));return h}function e(){}function f(a){return-1==a.indexOf("-")?a:a.replace(R,function(a){return a.charAt(1).toUpperCase()})}function g(c){c=N.extend({},O.ajax,c);var d=new a.XMLHttpRequest,e=null;if(c.data&&(e=h(c.data),"get"==c.type.toLowerCase()&&(c.url+=~c.url.indexOf("?")?"&"+e:"?"+e,e=null)),d.open(c.type,c.url,!0),c.headers){var f;for(f in c.headers)d.setRequestHeader(f,c.headers[f])}d.onreadystatechange=function(){if(4==this.readyState)if(this.status>=200&&this.status<300){var a=this.responseText;switch(c.dataType){case"json":try{a=X(a)}catch(d){a=null}break;case"html":try{var e=b.createElement("div");e.innerHTML=a,a=e.firstChild,e.removeChild(a),e=null}catch(d){a=null}break;case"script":break;case"jsonp":}c.success&&c.success.call(c,a,this)}else c.error&&c.error.call(c,this,this.responseText)},d.send(e)}function h(b){if("string"==typeof b)return b;if("number"==typeof b)return b.toString();if(!b)return"";var c,d=[];for(c in b)d.push(c+"="+a.encodeURIComponent(b[c]||""));return d.join("&")}function i(a,b,c){var d,e,f,g;if(~b.indexOf("."))for(g=b.split("."),e=a,d=0;d<g.length;d++)f=g[d],d==g.length-1?e[f]=c:e[f]?e=e[f]:e[f]={};else a[b]=c}function j(a){if(d(this,a),this.$parent=null,this.$childs=[],this.$element=null,this.$freeze=!1,this.$cache={},this.$subscribes={},this.$id){if(S[this.$id])throw new Error("The model id is exists.")}else this.$id="$"+Math.random().toString(36).substr(2);S[this.$id]=this}function k(a,b){var c=[];try{for(var d in a.$subscribes)("*"==d||d.startsWith(b))&&(c=c.concat(a.$subscribes[d]))}finally{return c}}function l(a,c){switch(a=a||b.documentElement,c=c||null,a.nodeType){case 1:O.igonreTags[a.tagName]||(c=n(a,c)||c,!a.$noScanChild&&a.childNodes.length&&m(a,c));break;case 3:o(a,c)}}function m(a,b){for(var c=a.firstChild;c;)l(c,b),c=c.$nextSibling||c.nextSibling}function n(a,b){for(var c,d,e,f=a.attributes,g=p(f),h=g.length;h--;)c=g[h],e=f[c.index],d=N.scanners[c.type],d&&(b=d(b,a,e.value,e,c.type,c.param)||b);return b}function o(a,b){u(b,a.data,w,function(b){a.data=b})}function p(a){var b=[];if(0===a.length)return b;for(var c,d,e,f,g=a.length;g--;){if(c=a[g],d=void 0,c.name.startsWith("x-"))e=c.name.indexOf("-",2),~e?(f=c.name.substr(0,e),d=c.name.substr(e+1)):f=c.name;else{if(!N.scanners[c.name])continue;f=c.name}b.push({index:c.name,type:f,param:d,priority:O.priorities[f]||1e3})}return 0===b.length?b:(b.sort(function(a,b){return a.priority>b.priority}),b)}function q(a,b,c,d,e){c!=e&&"true"!=c&&u(a,c,y,function(a){a?b.setAttribute(e,e):b.removeAttribute(e)})}function r(a,b,c,d){u(a,c,w,function(a){d.value=a})}function s(a,b,c,d,e){var f=e.substr(2);b.removeAttribute(d.name),u(a,c,w,function(a){b.setAttribute(f,a)})}function t(a,b,c,d,e){var f=e.substr(2),g=B(c),h=new Function("$model",g);b.removeAttribute(d.name),N.on(b,f,function(b){h(a)===!1&&(b.stopPropagation(),b.preventDefault())})}function u(a,b,c,d){var e={},f=c(b,e);if(!N.isEmptyObject(e)){var g=new Function("$model","return "+f),h={update:function(a,b){d(g(a,b))}};for(var i in e)a&&(a.$subscribe(i,h),h.update(a))}}function v(a,b){this.id=a,this.element=b,T[a]=this}function w(a,b){for(var c='""',d=O.interpolate[0],e=O.interpolate[1],f=d.length,g=e.length,h=!1,i=0,j=0,k=0;;){if(j=a.indexOf(d,j),!~j){c+='+"'+x(a.substr(i))+'"';break}if(k=a.indexOf(e,j+f),!~k){c+='+"'+x(a.substr(i))+'"';break}h=!0,c+='+"'+x(a.substring(i,j))+'"+'+y(a.substring(j+f,k),b,!0),i=j=k+=g}return h?c:!1}function x(a){return a.replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function y(a,b,c){try{var d=[],a=z(a,d),e=C(a.trim(),b,c);if(d.length){for(var f,g="(function(expr){",h=0;h<d.length;h++)f=d[h],g+='expr=$model.$filter("'+f.name+'",expr'+(f.args.trim()?","+f.args:"")+");";e=g+"return expr;}("+e+"))"}return e}catch(i){return""}}function z(a,b){for(var c,d=0;;){if(d=a.indexOf("|",d),!~d){c=a,b=[];break}if("|"!=a.charAt(d+1)){a.substr(d+1).split("|").forEach(function(a){var c=A(a);b.push(c)}),c=a.substr(0,d-1);break}d+=2}return c}function A(a){var b=U.exec(a);return{name:b[1],args:b[2]}}function B(a,b,c){b=b||{};var d="";if(~a.indexOf(";"))for(var e=a.split(";"),f=0;f<e.length;f++)f&&(d+=";"),d+=B(e[f],b,c);else if(~a.indexOf("=")){var g=a.split("=");d='$model.$set("'+g[0].trim()+'",'+C(g[1].trim(),b,c)+")"}else d=C(a,b,c)+";";return d}function C(a,b,c){var d=a.charAt(0);if('"'==d||"'"==d)return a;var e=a.match(V);if(e){for(var f,g,h="",i=0,j=0;j<e.length;j++)g=a.indexOf(e[j],i),f=a.substring(i,g),h+=D(f,c)+e[j],i=g+e[j].length,-1==e[j].indexOf("(")&&(b[f]=!0);if(a.length>i){f=a.substr(i);var k=D(f,c);k!=f&&(b[f]=!0),h+=k}return h}return h=D(a,c),h!=a&&(b[a]=!0),h}function D(a,b){return O.keywords[a]?a:W.test(a)?a:'$model.$get("'+a+'"'+(b?",0,1":"")+")"}function E(a,b,d){return null===Q&&(Q={},c.search&&decodeURIComponent(c.search).substr(1).split("&").map(function(a){var b=a.split("=");Q[b[0]]=b[1]})),b?void(b[a]=Q[a]||d):Q[a]}function F(a){if(!a)return null;switch(N.type(a)){case"string":return G(a);case"date":return a;case"number":return H(a);default:return null}}function G(a){var b=Date.parse(a);return isNaN(b)?null:H(b)}function H(a){return 1e11>a&&(a*=1e3),new Date(a)}function I(a,b){return b.replace(/[a-zA-Z]+/g,function(b){switch(b){case"yyyy":return a.getFullYear();case"mm":return J(a.getMonth()+1);case"m":return a.getMonth()+1;case"dd":return J(a.getDate());case"d":return a.getDate();case"hh":return J(a.getHours());case"h":return a.getHours();case"MM":return J(a.getMinutes());case"M":return a.getMinutes();case"ss":return J(a.getSeconds());case"s":return a.getSeconds();case"ww":return"\u661f\u671f"+"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split("")[a.getDay()];case"w":return"\u5468"+"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split("")[a.getDay()];case"l":return"";default:return b}})}function J(a){return a>9?a:"0"+a}function K(a){this.$$page=a.page?P.number.test(a.page)?+a.page:+E(a.page)||1:1,this.$$pageSize=a.pageSize?P.number.test(a.pageSize)?+a.pageSize:+E(a.pageSize)||20:20,this.$$sort="",this.$$order="",this.$$params={page:this.$$page,pageSize:this.$$pageSize},this.$$url=a.url,this.$$name=a.name,this.$read()}function L(a,b){a.form&&(N.on(a,"keyup",b),N.on(a,"change",b))}function M(a,b,c){var d,e,f=a.form,g=N.getExtModel(f);g&&(d=a.name,e=g.$xform+"."+a.name,g.$set(e+".$valid",c),g.$set(e+".$error."+b,!c))}var N=function(a){return new j(a)},O={interpolate:["{{","}}"]};O.igonreTags={SCRIPT:!0,NOSCRIPT:!0,IFRAME:!0},O.priorities={"x-skip":0,"x-controller":10,"x-repeat":20,"x-if":50};var P={url:/^https?\:\/\/[-a-z0-9\.]+(\/.*)?$/,email:/^[\w\.\-]+\@[-a-z0-9]+\.\w+$/,number:/^\-?\d*\.?\d+$/,phone:/^1\d{10}$/,telphone:/^0\d{10,11}/,idcard:/^\d{6}(19\d{2}|20\d{2})(0\d|1[012])([012]\d|3[01])\d{3}[\dx]$/},Q=null;d(N,{extend:d,noop:e,isEmptyObject:function(a){var b;if(!N.type(a,"object"))return!1;for(b in a)return!1;return!0},type:function(a,b){if(b)return N.type(a)==b;var c={},d=c.toString.call(a);return d.slice(8,-1).toLowerCase()},ready:function(a){b.addEventListener("DOMContentLoaded",function(){a()},!1)},addClass:function(a,b){a.classList?a.classList.add(b):a.className?~a.className.split(" ").indexOf(b)||(a.className=a.className+" "+b):a.className=b},removeClass:function(a,b){if(a.classList)a.classList.remove(b);else if(a.className){var c=a.className.split(" ");c.remove(b),a.className=c.join(" ")}},css:function(b,c,d){if(2==arguments.length){var e=a.getComputedStyle?a.getComputedStyle(b):b.currentStyle,f=e[c];return f}b.style[c]=d},on:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},config:function(a,b){O.hasOwnProperty(a)?O[a]=b:N.isPlainObject(a)&&d(O,a)}}),"".startsWith||(String.prototype.startsWith=function(a){return 0===this.indexOf(a)}),Array.prototype.remove=function(a){for(var b=this.length;b--;)a==this[b]&&this.splice(b,1)};var R=/-[^-]/g;O.ajax={type:"GET",dataType:"text"};var S={};j.prototype={$get:function(a,b,c){if(this.$cache.hasOwnProperty(a))return this.$cache[a];if(!~a.indexOf("."))return this.hasOwnProperty(a)?this[a]:this.$parent?this.$parent.$get(a):c?"":void 0;for(var d,e=this,f=a.split("."),g=0;g<f.length;g++){if(d=f[g],!e[d])return e.hasOwnProperty(d)?c?"":e[d]:b?c?"":void 0:this.$parent?this.$parent.$get(a):c?"":void 0;if("function"==typeof e[d])return function(){return e[d].apply(e,arguments)};if(g==f.length-1)return e[d];e=e[d]}},$set:function(a,b){i(this,a,b),this.$cache[a]=b,this.$notifySubscribes(a),delete this.$cache[a]},$subscribe:function(a,b){this.$subscribes[a]||(this.$subscribes[a]=[]),this.$subscribes[a].push(b)},$unsubscribe:function(a,b){this.$subscribes[a]&&this.$subscribes[a].remove(b)},$notifySubscribes:function(a){if(!this.$freeze)for(var b=k(this,a),c=0;c<b.length;c++)b[c].update(this,a)},$bindElement:function(a){if(a.$modelId)throw new Error("\u4e0d\u80fd\u91cd\u590d\u7ed1\u5b9amodel.");var b=this;if(b.$parent=N.getParentModel(a),b.$parent){b.$parent.$childs.push(b);var c={update:function(a,c){b.hasOwnProperty(c)||b.$notifySubscribes(c)}};b.$parent.$subscribe("*",c)}a.$modelId=b.$id,this.$element=a},$filter:function(a,b,c){var d=N.filters[a];return d?(arguments.length>2?(c=Array.prototype.slice.call(arguments),c.shift()):c=[b],d.apply(null,c)):b}},d(N,{getModel:function(a){try{return S[a.$modelId]}catch(b){return null}},getParentModel:function(a){var b=a.$modelId;if(b)return S[b];for(;a=a.parentNode;)if(a.$modelId)return S[a.$modelId];return null},getExtModel:function(a){return N.getModel(a)||N.getParentModel(a)},destroyModel:function(a,b){a.$childs.length&&a.$childs.forEach(function(a){N.destroyModel(a,b)}),delete S[a.$id],a.$element&&(b?a.$element.parentNode.removeChild(a.$element):a.$element.$modelId=void 0),a=null}}),N.scan=l,N.scanners={},O.booleanBindAttrs=["disabled","checked","selected","contenteditable","draggable","dropzone"],O.booleanBindAttrs.forEach(function(a){N.scanners[a]=q}),O.stringBindAttrs=["target","title","width","height","name","alt","align","valign","clos","rows","clospan","rowspan","cellpadding","cellspacing","method","color","border","size","face","color","value","label","wrap"],O.eventBindAttrs=["blur","focus","focusin","focusout","load","resize","scroll","unload","click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","change","select","submit","keydown","keypress","keyup","error","contextmenu"],O.stringBindAttrs.forEach(function(a){N.scanners[a]=r}),"x-src x-href".split(" ").forEach(function(a){N.scanners[a]=s}),O.eventBindAttrs.forEach(function(a){N.scanners["x-"+a]=t}),N.extend(N.scanners,{"x-skip":function(a,b,c,d){b.removeAttribute(d.name),b.$noScanChild=!0},"x-controller":function(a,b,c,d){return a=S[c],b.removeAttribute(d.name),a&&!a.element?(a.$bindElement(b),a):void 0},"x-template":function(a,b,c,d){b.$nextSibling=b.nextSibling,b.$noScanChild=!0,b.removeAttribute(d.name),new v(c,b),b.parentNode.removeChild(b)},"x-include":function(a,b,c,d){b.$noScanChild=!0,b.removeAttribute(d.name),u(a,c,y,function(c){if(T[c]){var d=T[c].element.cloneNode(!0);b.innerHTML="",b.appendChild(d),l(d,a)}else g({url:c,cache:!0,dataType:"html",success:function(d){var e=new v(c,d),f=e.element.cloneNode(!0);b.innerHTML="",b.appendChild(f),l(f,a)},error:function(){throw new Error("Cannot find template: "+c)}})})},"x-repeat":function(a,c,d,e,f,g){var h=c.parentNode,i=b.createComment("x-repeat-start:"+g),k=b.createComment("x-repeat-end:"+g);h.insertBefore(i,c),h.insertBefore(k,c.nextSibling),c.$nextSibling=c.nextSibling,c.$noScanChild=!0,c.removeAttribute(e.name),c.parentNode.removeChild(c),u(a,d,y,function(a){if(N.type(a,"array")){for(var b,d=i.nextSibling;d&&d!=k;)b=N.getModel(d),N.destroyModel(b,!0),d=i.nextSibling;a.forEach(function(b,d){var e=c.cloneNode(!0),f=new j({$index:d,$remove:function(){N.destroyModel(f,!0)},$first:!d,$last:d==a.length,$middle:d>0&&d<a.length});f[g]=b,h.insertBefore(e,k),f.$bindElement(e),l(e,f)})}})},"x-if":function(a,c,d,e){var f=c.parentElement,g=N.getParentModel(c),h=b.createComment("x-if:"+a.$id);return c.$nextSibling=c.nextSibling,c.removeAttribute(e.name),a=N.getModel(c)||new j,c.$modelId||a.$bindElement(c),u(g,d,y,function(b){if(b){c.parentElement||f.replaceChild(c,h),a.$freeze=!1;for(var d in a.$subscribes)a.$notifySubscribes(d)}else c.parentElement&&f.replaceChild(h,c),a.$freeze=!0}),a},"x-show":function(a,b,c,d){b.removeAttribute(d.name),u(a,c,y,function(a){b.style.display=a?"":"none"})},"x-bind":function(a,b,c,d){function e(d){N.on(b,d,function(){a.$set(c,b.value)})}switch(b.removeAttribute(d.name),u(a,c,y,function(a){"INPUT"==b.tagName?"radio"==b.type?b.checked=a==b.value?!0:!1:"checkbox"==b.type?b.checked=~a.indexOf(b.value)?!0:!1:b.value=a||"":b.value=a||""}),b.tagName){case"INPUT":switch(b.type){case"checkbox":var f=a.$get(c);if(f&&!N.type(f,"array"))throw new TypeError("Checkbox bind must be array.");f||a.$set(c,[]),N.on(b,"click",function(){var d=a.$get(c),e=b.value;b.checked?d.push(e):d.remove(e),a.$set(c,d)});break;case"radio":e("click");break;default:e("keyup"),e("change")}break;case"SELECT":e("change");break;case"TEXTAREA":e("keyup"),e("change")}},"x-class":function(a,b,c,d,e,f){b.removeAttribute(d.name),u(a,c,y,function(a){a?N.addClass(b,f):N.removeClass(b,f)})},"x-ajax":function(a,b,c,d,e,f){b.removeAttribute(d.name),b.$modelId||(a=new j,a.$bindElement(b));var h=function(){g({type:"GET",dataType:"json",cache:!1,url:c,success:function(b){for(var c in b)a.$set(f+"."+c,b[c])},error:function(b,c){a.$set(f+".$error",c)}})};return h(),a[f]={$read:h},a},"x-style":function(a,b,c,d,e,g){var h=f(g);b.removeAttribute(d.name),u(a,c,y,function(a){b.style[h]=a})}});var T={},U=/(\w+)(.*)/,V=/[^\w\$\.]+/g;O.keywords={},"return if else true false null undefined NaN do while typeof instanceof function void with var this try throw catch new in for break continue switch default delete".split(" ").forEach(function(a){O.keywords[a]=!0});var W=/^\-?\d?\.?\d+$/,X=a.JSON?a.JSON.parse:function(a){return new Function("","return "+a.trim())()};N.filters={date:function(a,b){var c=F(a);return I(c,b)},limit:function(a,b,c){return a.length<=b?a:(c=c||"...",a.substring(0,b)+c)},number:function(a,b){return a=+a,a.toFixed(b)}},N.filters.date.format=function(a,b){dateFormatter[a]=b},N.scanners["x-grid"]=function(a,b,c,d,e,f){b.removeAttribute(d.name),b.$modelId||(a=new j,a.$bindElement(b));var g={name:f,url:c,page:b.getAttribute("page"),pageSize:b.getAttribute("page-size")};return a[f]=new K(g),a[f].$$model=a,a},K.prototype={$read:function(a){arguments.length&&(this.$$params=a,this.$$page=1);var b=this,c=this.$$params;d(c,{page:this.$$page,pageSize:this.$$pageSize}),this.$$sort&&(c.sort=this.$$sort),this.$$order&&(c.order=this.$$order),g({type:"GET",dataType:"json",cache:!1,url:this.$$url,data:c,success:function(a){for(var c in a)b.$$model.$set(b.$$name+"."+c,a[c])},error:function(a,c){b.$$model.$set(b.$$name+".$error",c)}})},$page:function(a){return a?(this.$$page=a,void this.$read()):this.$$page},$pageSize:function(a){return a?(this.$$pageSize=a,this.$$page=1,this.$read(),void 0):this.$$pageSize},$sort:function(a,b){this.$$sort=a,this.$$order=b||"",this.$read()}},d(N.scanners,{"x-form":function(a,b,c,e,f,g){return b.removeAttribute(e.name),d(a,{$xform:g,$dirty:!1,$valid:!0}),a},min:function(a,b,c){var d=+c;L(b,function(){M(b,"min",+b.value>=d)})},max:function(a,b,c){var d=+c;L(b,function(){M(b,"max",+b.value<=d)})},minlength:function(a,b,c){var d=+c;L(b,function(){M(b,"minlength",b.value.length>=d)})},maxlength:function(a,b,c){var d=+c;L(b,function(){M(b,"maxlength",b.value.length<=d)})},pattern:function(a,b,c){var d=new RegExp(c);L(b,function(){M(b,"pattern",b.value.test(d))})},required:function(a,b){L(b,function(){M(b,"required",!!b.value)})},type:function(a,b,c){c=c.toLowerCase(),P[c]&&L(b,function(){M(b,"type",b.value.test(P[c]))})}}),N.ready(l),a.vmodel=N}(window,window.document,window.location,window.history);