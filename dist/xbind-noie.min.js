/*!
 * Simple MVVM Library. v0.4.3
 * https://github.com/sprufu/xbind.git
 */
!function(a,b,c){function d(a){return"string"==typeof a&&(a={$id:a}),new i(a)}function e(){var a,b,c,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;for("boolean"==typeof i&&(l=i,i=arguments[1]||{},j=2),"object"!=typeof i&&"function"!=typeof i&&(i={}),k===j&&(i=this,--j);k>j;j++)if(null!=(a=arguments[j]))for(b in a)c=i[b],f=a[b],i!==f&&(l&&f&&(d.type(f,"object")||(g=d.type(f,"array")))?(g?(g=!1,h=c&&d.type(c,"object")?c:[]):h=c&&d.type(c,"object")?c:{},i[b]=e(l,h,f)):void 0!==f&&(i[b]=f));return i}function f(a,b){for(var c=a.length;c--;)b===a[c]&&a.splice(c,1)}function g(a){return-1==a.indexOf("-")?a:a.replace(Q,function(a){return a.charAt(1).toUpperCase()})}function h(a,b,c){var d,e,f,g;if(~b.indexOf("."))for(g=b.split("."),e=a,d=0;d<g.length;d++)f=g[d],d==g.length-1?e[f]=c:e[f]||(e[f]={}),e=e[f];else a[b]=c}function i(a){if(e(this,a,{$parent:null,$childs:[],$element:null,$freeze:!1,$cache:{},$subscribes:{}}),this.$id){if(T[this.$id])throw new Error("The model id is exists.")}else this.$id="$"+Math.random().toString(36).substr(2);T[this.$id]=this}function j(a,b){for(var c=b.split("."),d=a,e=0;e<c.length;e++)d=d[c[e]];return d}function k(a,b){var c=[];try{for(var d in a.$subscribes)("*"==d||d.startsWith(b))&&(c=c.concat(a.$subscribes[d]))}finally{return c}}function l(a){return T[a.$modelId]||null}function m(a){for(a=a.parentNode;a;){if(a.$modelId)return T[a.$modelId];a=a.parentNode}return null}function n(a){return l(a)||m(a)}function o(a){a.$childs.forEach(function(a){a.$parent=null,o(a)}),delete T[a.$id],a.$element=null,a.$subscribes=null;var b=a.$parent;if(b){f(b.$childs,a);for(var c=b.$subscribes["*"],d=c.length;d--;)c[d].isChildSubscribe&&c.splice(d,1);b=null}}function p(a,b){if(!b&&a.$modelId)o(T[a.$modelId]);else for(var c=a.firstChild;c;)1==c.nodeType&&p(c),c=c.nextSibling}function q(a,c,d){switch(a=a||b.documentElement,Z=d,c||(c=new i,c.$scope(a)),a.nodeType){case 1:O.igonreTags[a.tagName]||(c=s(a,c)||c,!a.$noScanChild&&a.childNodes.length&&r(a,c,d));break;case 3:t(a,c)}}function r(a,b,c){for(var d=a.firstChild;d;)q(d,b,c),d=d.$nextSibling||d.nextSibling}function s(a,b){for(var c,e,f,g=a.attributes,h=u(g),i=h.length;i--;)if(c=h[i],f=g[c.index],e=d.scanners[c.type],e&&(b=e(b,a,f.value,f,c.param)||b),a.$skipOtherAttr){delete a.$skipOtherAttr;break}return b}function t(a,b){w(b,a.data,z,function(b){a.data=b})}function u(a){for(var b,c,e,f,g=[],h=a.length;h--;)if(b=a[h],!O.igonreAttrs[b.name]){if(c=void 0,b.name.startsWith("x-"))e=b.name.indexOf("-",2),~e?(f=b.name.substr(0,e),c=b.name.substr(e+1)):f=b.name;else{if(!d.scanners[b.name])continue;f=b.name}g.push({index:b.name,type:f,param:c,priority:O.priorities[f]||1e3})}return g.sort(function(a,b){return a.priority<b.priority}),g}function v(a,b,c,e,f,g){b&&a.removeAttribute(b),c&&d.removeClass(c),e&&(a.$noScanChild=!0),f&&(a.$nextSibling=a.nextSibling),g&&(a.$skipOtherAttr=!0)}function w(a,b,c,e){var f={},g=c(b,f);if(d.isEmptyObject(f))return!1;var h=x(g),i={update:function(a){e(h(a,d.filter))}};for(var j in f)a&&(a.$watch(j,i),i.update(a))}function x(a){if(U[a])return U[a];var b=new Function("$model,filter","return "+a);return U[a]=b,b}function y(a,b){this.id=a,this.element=b,V[a]=this}function z(a,b){var c;if(Z&&(c=$.string[a]))return e(b,c.fields),c.expr;for(var d,f='""',g=O.interpolate[0],h=O.interpolate[1],i=g.length,j=h.length,k=!1,l=0,m=0,n=0;;){if(m=a.indexOf(g,m),!~m){d=A(a.substr(l)),d&&(f+='+"'+d+'"');break}if(n=a.indexOf(h,m+i),!~n){d=A(a.substr(l)),d&&(f+='+"'+d+'"');break}k=!0,d=A(a.substring(l,m)),d&&(f+='+"'+d+'"'),f+="+"+B(a.substring(m+i,n),b,!0),l=m=n+=j}return Z&&($.string[a]={fields:b,expr:f}),k?f:!1}function A(a){return a.replace(/\r/g,"\\r").replace(/\n/g,"\\n")}function B(a,b,c){var d;if(Z&&(d=$.express[a]))return e(b,d.fields),d.expr;try{var f,g=[];if(a=C(a,g,b),f=F(a.trim(),b,c),g.length){for(var h,i="(function(expr){",j=0;j<g.length;j++)h=g[j],i+='expr=filter("'+h.name+'",expr'+(h.args.trim()?","+h.args:"")+");";f=i+"return expr;}("+f+", $model))"}return Z&&($.express[a]={fields:b,expr:f}),f}catch(k){return""}}function C(a,b,c){for(var d,e=0;;){if(e=a.indexOf("|",e),!~e){d=a,b=[];break}if("|"!=a.charAt(e+1)){a.substr(e+1).split("|").forEach(function(a){var d=D(a,c);b.push(d)}),d=a.substr(0,e-1);break}e+=2}return d}function D(a,b){var c=W.exec(a);return{name:c[1],args:F(c[2].trim(),b)}}function E(a){var b={},c="";if(~a.indexOf(";"))for(var d=a.split(";"),e=0;e<d.length;e++)e&&(c+=";"),c+=E(d[e].trim());else if(~a.indexOf("=")){var f=a.split("=");c='$model.$set("'+f[0].trim()+'",'+F(f[1].trim(),b)+")"}else c=F(a,b)+";";return c}function F(a,b,c){var d,e,f=a.charAt(0);if('"'==f||"'"==f)return a;if(e=a.match(X)){d="";for(var g,h,i=0,j=0;j<e.length;j++)Y.test(e[j])||(h=a.indexOf(e[j],i),g=a.substring(i,h),d+=G(g,c)+e[j],i=h+e[j].length,-1==e[j].indexOf("(")&&(b[g]=!0));if(a.length>i){g=a.substr(i);var k=G(g,c);k!=g&&(b[g]=!0),d+=k}return d}return d=G(a,c),d!=a&&(b[a]=!0),d}function G(a,b){if(!a)return"";if(O.keywords[a])return a;if(P.number.test(a))return a;var c=a.charAt(0);return'"'==c||"'"==c?a:'$model.$get("'+a+'"'+(b?",0,1":"")+")"}function H(a){if(!a)return null;switch(/^\d{10}$|^\d{13}$/.test(a)&&(a=+a),d.type(a)){case"string":return I(a);case"date":return a;case"number":return J(a);default:return null}}function I(a){var b=Date.parse(a);return isNaN(b)?null:J(b)}function J(a){return 1e11>a&&(a*=1e3),new Date(a)}function K(a,b){return a?b.replace(/[a-zA-Z]+/g,function(b){switch(b){case"yyyy":return a.getFullYear();case"mm":return L(a.getMonth()+1);case"m":return a.getMonth()+1;case"dd":return L(a.getDate());case"d":return a.getDate();case"hh":return L(a.getHours());case"h":return a.getHours();case"MM":return L(a.getMinutes());case"M":return a.getMinutes();case"ss":return L(a.getSeconds());case"s":return a.getSeconds();case"ww":return"\u661f\u671f"+"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split("")[a.getDay()];case"w":return"\u5468"+"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split("")[a.getDay()];case"l":return"";default:return ab[b]?ab[b].call(a):b}}):""}function L(a){return a>9?a:"0"+a}function M(a,b){a.form&&(d.on(a,"keyup",b),d.on(a,"change",b))}function N(a,b,c){var d,e,f=a.form,g=n(f);g&&(d=a.name,e=g.$xform+"."+a.name,g.$set(e+".$valid",c),g.$set(e+".$error."+b,!c))}var O={interpolate:["{{","}}"],scanOnReady:!0,igonreTags:{SCRIPT:!0,NOSCRIPT:!0,IFRAME:!0},igonreAttrs:{"x-ajax-if":!0},priorities:{"x-skip":0,"x-repeat":10,"x-controller":20,"x-if":50}},P=d.regexps={url:/^https?\:\/\/[-a-z0-9\.]+(\/.*)?$/,email:/^[\w\.\-]+\@[-a-z0-9]+\.\w+$/,number:/^\-?\d*\.?\d+$/,phone:/^1\d{10}$/,telphone:/^0\d{10,11}/,idcard:/^\d{6}(19\d{2}|20\d{2})(0\d|1[012])([012]\d|3[01])\d{3}[\dx]$/};e(d,{mix:e,isEmptyObject:function(a){var b;if(!d.type(a,"object"))return!1;for(b in a)return!1;return!0},each:function(a,b){if(a.forEach)a.forEach(b);else{var c;for(c in a)b.call(a,a[c],c)}},type:function(a,b){if(b)return d.type(a)==b;var c={},e=c.toString.call(a);return e.slice(8,-1).toLowerCase()},ready:function(a){b.addEventListener("DOMContentLoaded",function(){a()},!1)},addClass:function(a,b){a.classList?a.classList.add(b):a.className?~a.className.split(" ").indexOf(b)||(a.className=a.className+" "+b):a.className=b},removeClass:function(a,b){if(a.classList)a.classList.remove(b);else if(a.className){var c=a.className.split(" ");f(c,b),a.className=c.join(" ")}},css:function(b,c,d){if(2==arguments.length){var e=a.getComputedStyle?a.getComputedStyle(b):b.currentStyle,f=e[c];return f}b.style[c]=d},on:function(a,b,c){if(d.type(b,"object"))for(var e in b)d.on(a,e,b[e]);else a.addEventListener(b,function(b){var d=c.call(a,b);d===!1&&(b.preventDefault(),b.stopPropagation())},!1)},emit:function(b,c){var d=new a.Event(c);b.dispatchEvent(d)},config:function(a,b){O.hasOwnProperty(a)?O[a]=b:d.type(a,"object")&&e(!0,O,a)}}),"".startsWith||(String.prototype.startsWith=function(a){return 0===this.indexOf(a)});var Q=/-[^-]/g,R="application/x-www-form-urlencoded",S=d.ajax=function(c){c=e({},O.ajax,c);var f,g=a.XMLHttpRequest||a.ActiveXObject,h=new g("Microsoft.XMLHTTP"),i=null;if(c.data&&(c.contentType==R&&(i=d.param(c.data)),"get"==c.type.toLowerCase()&&(c.url+=(~c.url.indexOf("?")?"&":"?")+i,i=null)),c.cache||(c.url+=(~c.url.indexOf("?")?"&":"?")+(new Date).getTime().toString()),c.dataType=c.dataType.toLowerCase(),"jsonp"==c.dataType&&(f="callback"+Math.random().toString(36).substr(2),c.url+=(~c.url.indexOf("?")?"&":"?")+"callback="+f,a[f]=function(a){c.success.call(c,a,h)}),h.open(c.type,c.url,c.async),c.headers){var j;for(j in c.headers)h.setRequestHeader(j,c.headers[j])}h.setRequestHeader("Content-Type",c.contentType),h.onreadystatechange=function(){if(4==this.readyState){var e=c.statusCode[this.status];if(e&&e.call(h)===!1)return;var g;if(d.each(c.headerCode,function(a,b){var c=h.getResponseHeader(b);c&&a.call(h,c)===!1&&(g=!1)}),g===!1)return;if(this.status>=200&&this.status<300){var i,j=this.responseText;switch(c.dataType){case"json":try{j=_(j)}catch(k){j=null}break;case"html":try{i=b.createElement("div"),i.innerHTML=j.trim(),j=i.firstChild,i.removeChild(j),i=null}catch(k){j=null}break;case"xml":j=this.responseXML;break;case"jsonp":case"script":if(i=b.createElement("script"),b.body.appendChild(i),i.innerHTML=j,b.body.removeChild(i),"jsonp"==c.dataType)return void delete a[f]}c.success&&c.success.call(c,j,this)}else c.error&&c.error.call(c,this,decodeURIComponent(this.statusText))}},h.send(i)};O.ajax={async:!0,type:"get",dataType:"text",contentType:R,statusCode:{},headerCode:{location:function(a){return c.href=a,!1}}},d.param=function(b,c){if("string"==typeof b)return a.encodeURIComponent(b);if("number"==typeof b)return b.toString();if(!b)return"";var e,f,g=[];c=c||"";for(e in b)b.hasOwnProperty(e)&&!d.type(b[e],"function")&&(f=c?c+"["+e+"]":e,g.push("object"==typeof b[e]?d.param(b[e],f):f+"="+a.encodeURIComponent(b[e]||"")));return g.join("&")};var T={};i.prototype={$get:function(a,b,c){if(this.$cache.hasOwnProperty(a))return this.$cache[a];for(var d,e=this;e;)try{if(d=j(e,a),void 0!==d)break;e=e.$parent}catch(f){if(b)break;e=e.$parent}return"function"==typeof d&&(d=d.bind(this)),d?d:c?"":void 0},$set:function(a,b){if(d.type(a,"object")){var c,e=b?b+".":"";for(c in a)this.$cache[e+c]=a[c],h(this,e+c,a[c]);for(c in a)this.$fire(e+c);for(c in a)delete this.$cache[e+c]}else h(this,a,b),this.$cache[a]=b,this.$fire(a),delete this.$cache[a]},$watch:function(a,b){this.$subscribes[a]||(this.$subscribes[a]=[]),this.$subscribes[a].push(b)},$unwatch:function(a,b){this.$subscribes[a]&&f(this.$subscribes[a],b)},$fire:function(a){if(!this.$freeze)for(var b=k(this,a),c=0;c<b.length;c++)b[c].update(this,a)},$scope:function(a,b){if(a.$modelId)throw new Error("\u4e0d\u80fd\u91cd\u590d\u7ed1\u5b9amodel.");var c=this;if(!b&&(c.$parent=m(a),c.$parent)){c.$parent.$childs.push(c);var d={isChildSubscribe:!0,update:function(a,b){c.hasOwnProperty(b)||c.$fire(b)}};c.$parent.$watch("*",d)}a.$modelId=c.$id,this.$element=a}},d.model=function(a){return"string"==typeof a?T[a]||null:n(a)},d.scan=q,d.scanners={"x-skip":function(a,b,c,d){v(b,d.name,0,1,0,1)},"x-click":function(a,b,c,e){d.scanners["x-on"](a,b,c,e,"click")},"x-on":function(a,b,c,e,f){var g=x(E(c));v(b,e.name),d.on(b,f,function(){return g(a)})},href:function(a,b,c){"A"==b.tagName&&""===c&&d.on(b,"click",function(){return!1})},"x-controller":function(a,b,c,d,e){return a=T[c],v(b,d.name,"x-controller"),a&&!a.element?(a.$scope(b,"top"!=e),a):void 0},"x-init":function(a,b,c,d){if(a){v(b,d.name);var e=E(c),f=new Function("$model",e);f(a)}},"x-template":function(a,b,c,d){v(b,d.name,"x-template",1,1),new y(c,b),b.parentNode.removeChild(b)},"x-include":function(a,b,c,d){v(b,d.name,"x-include",1),w(a,c,B,function(c){if(p(b,!0),V[c]){var d=V[c].element.cloneNode(!0);b.innerHTML="",b.appendChild(d),q(d,a)}else S({url:c,cache:!0,dataType:"html",success:function(d){var e=new y(c,d),f=e.element.cloneNode(!0);b.innerHTML="",b.appendChild(f),q(f,a)},error:function(){throw new Error("Cannot find template: "+c)}})})},"x-repeat":function(a,c,e,f,g){var h=c.parentNode,j=b.createComment("x-repeat-start:"+g),k=b.createComment("x-repeat-end:"+g);h.insertBefore(j,c),h.insertBefore(k,c.nextSibling),v(c,f.name,"x-repeat",1,1,1),c.parentNode.removeChild(c),w(a,e,B,function(a){if(a){for(var b=j.nextSibling;b&&b!=k;)p(b),b.parentNode.removeChild(b),b=j.nextSibling;d.each(a,function(b,d){var e=c.cloneNode(!0),f=new i({$index:d,$key:d,$remove:function(){e.parentNode.removeChild(e),o(f)},$first:!d,$last:d==a.length,$middle:d>0&&d<a.length});f[g]=b,h.insertBefore(e,k),f.$scope(e),q(e,f,!0),e=null})}})},"x-if":function(a,c,d,e){var f=c.parentElement,g=m(c),h=b.createComment("x-if:"+a.$id);return v(c,e.name,"x-if",0,1),a=l(c)||new i,c.$modelId||a.$scope(c),w(g,d,B,function(b){if(b){c.parentElement||f.replaceChild(c,h),a.$freeze=!1;for(var d in a.$watchs)a.$fire(d)}else c.parentElement&&f.replaceChild(h,c),a.$freeze=!0}),a},"x-show":function(a,b,c,d){v(b,d.name,"x-show"),w(a,c,B,function(a){a?b.removeAttribute("hidden"):b.setAttribute("hidden","hidden")})},"x-bind":function(a,b,c,e){function g(e){d.on(b,e,function(){a.$set(c,b.value)})}switch(v(b,e.name),w(a,c,B,function(a){"INPUT"==b.tagName?"radio"==b.type?b.checked=a==b.value?!0:!1:"checkbox"==b.type?b.checked=!a||~a.indexOf(b.value)?!0:!1:b.value=a||"":b.value=a||""}),b.tagName){case"INPUT":switch(b.type){case"checkbox":var h=a.$get(c);if(h&&!d.type(h,"array"))throw new TypeError("Checkbox bind must be array.");h||a.$set(c,[]),d.on(b,"click",function(){var d=a.$get(c),e=b.value;b.checked?d.push(e):f(d,e),a.$set(c,d)});break;case"radio":g("click");break;default:g("keyup"),g("change")}break;case"SELECT":g("change");break;case"TEXTAREA":g("keyup"),g("change")}},"x-class":function(a,b,c,e,f){v(b,e.name,"x-class"),w(a,c,B,function(a){a?d.addClass(b,f):d.removeClass(b,f)})},"x-attr":function(a,b,c,d,e){v(b,d.name),w(a,c,z,function(a){a?b.setAttribute(e,a):b.removeAttribute(e)})},"x-ajax":function(a,b,c,d,e){v(b,d.name,"x-ajax");var f,g=!0,h=b.getAttribute("x-ajax-if"),i=function(){S({type:"GET",dataType:"json",cache:!1,url:f,success:function(b){a.$set(e+".$error",null),a.$set(b,e)},error:function(b,c){a.$set(e+".$error",c)}})};a[e]={$read:i},h&&(b.removeAttribute("x-ajax-if"),w(a,h,B,function(a){g=a}));var j=w(a,c,z,function(a){f=a,g&&i()});return j===!1&&(f=c,g&&i()),a},"x-style":function(a,b,c,e,f){var h=g(f);v(b,e.name,"x-style"),w(a,c,B,function(a){d.css(b,h,a)})}};var U={},V={},W=/(\w+)(.*)/,X=/[-\+\*\/\=\(\)\%\&\|\^\!\~\,\?\s]+/g,Y=/^[\s\uFEFF\xA0]$/,Z=!1,$={string:{},express:{}},_=a.JSON?a.JSON.parse:function(a){return new Function("","return "+a.trim())()};O.keywords={},"$model return if else true false null undefined this".split(" ").forEach(function(a){O.keywords[a]=!0}),O.scanOnReady&&d.ready(q),a.xbind=d,d.filters={date:function(a,b){var c=H(a);return K(c,b)},limit:function(a,b,c){return a.length<=b?a:(void 0===c&&(c="..."),a.substring(0,b)+c)},number:function(a,b){return a=+a,a.toFixed(b)},"default":function(a,b,c){return c&&void 0===a||!a?b:a},text:function(a,c){if(!a)return"";var d,e=b.createElement("div");return c?(e.innerHTML=a,d=e.innerText):(e.innerText=a,d=e.innerHTML),e=null,d},convert:function(a,b,c){return a&&a.forEach?a.forEach(function(a){a[c]=a[b]}):a&&(a[c]=a[b]),a},sort:function(a,b,c){return"boolean"==typeof b&&(c=b,b=null),a&&a.sort?a.sort("function"==typeof b?b:function(a,d){return b?c?a[b]>d[b]:a[b]<d[b]:c?a>d:d>a}):a},foreign:function(a,b){return b&&b[a]},param:d.param};var ab={};d.filters.date.format=function(a,b){ab[a]=b},d.filter=function(a,b,c){var e=d.filters[a];return e?(arguments.length>2?(c=Array.prototype.slice.call(arguments),c.shift()):c=[b],e.apply(null,c)):b},e(d.scanners,{"x-form":function(a,b,c,d,f){return b.removeAttribute(d.name),e(a,{$xform:f,$dirty:!1,$valid:!0}),a},min:function(a,b,c){var d=+c;M(b,function(){N(b,"min",+b.value>=d)})},max:function(a,b,c){var d=+c;M(b,function(){N(b,"max",+b.value<=d)})},minlength:function(a,b,c){var d=+c;M(b,function(){N(b,"minlength",b.value.length>=d)})},maxlength:function(a,b,c){var d=+c;M(b,function(){N(b,"maxlength",b.value.length<=d)})},pattern:function(a,b,c){var d=new RegExp(c);M(b,function(){N(b,"pattern",b.value.test(d))})},required:function(a,b){M(b,function(){N(b,"required",!!b.value)})},type:function(a,b,c){c=c.toLowerCase(),P[c]&&M(b,function(){N(b,"type",b.value.test(P[c]))})}})}(window,document,location,history);
//# sourceMappingURL=xbind-noie.min.js.map